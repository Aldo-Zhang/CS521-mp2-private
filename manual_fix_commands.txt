# æ‰‹åŠ¨ä¿®å¤å‘½ä»¤ - åœ¨è™šæ‹Ÿæœºä¸Šè¿è¡Œ

# 1. ä¿®å¤JAXæ–‡ä»¶
echo "ðŸ”§ Fixing JAX file..."

# å¤‡ä»½åŽŸæ–‡ä»¶
cp gpu/myconv_jax.py gpu/myconv_jax.py.backup

# ä½¿ç”¨sedæ›¿æ¢GPUæ£€æµ‹ä»£ç 
sed -i 's/# å°è¯•ä½¿ç”¨GPUï¼Œå¦‚æžœå¤±è´¥åˆ™å›žé€€åˆ°CPU/# å¼ºåˆ¶ä½¿ç”¨CPUé¿å…CuDNNç‰ˆæœ¬é—®é¢˜/' gpu/myconv_jax.py
sed -i 's/try:/print("Forcing JAX to use CPU to avoid CuDNN version conflicts")/' gpu/myconv_jax.py
sed -i 's/# æ£€æŸ¥JAX GPUå¯ç”¨æ€§/os.environ["JAX_PLATFORM_NAME"] = "cpu"/' gpu/myconv_jax.py
sed -i 's/gpu_devices = jax.devices/# jax.config.update("jax_platform_name", "cpu")/' gpu/myconv_jax.py

echo "âœ… JAX file fixed"

# 2. åˆ›å»ºå¿«é€Ÿæµ‹è¯•è„šæœ¬
cat > quick_test.py << 'EOF'
#!/usr/bin/env python3
"""
å¿«é€Ÿæµ‹è¯•è„šæœ¬ - åªæµ‹è¯•ä¸€ä¸ªæœ€å°é…ç½®
"""

import subprocess
import sys

def quick_test():
    print("ðŸš€ Quick Test")
    print("=============")
    
    # åªæµ‹è¯•ä¸€ä¸ªæœ€å°é…ç½®
    cmd = [sys.executable, "gpu/myconv.py", "--input_size", "16", "--kernel_size", "3"]
    
    print(f"Running: {' '.join(cmd)}")
    try:
        result = subprocess.run(cmd, capture_output=True, text=True, timeout=60)
        if result.returncode == 0:
            print("âœ… PyTorch Baseline: SUCCESS")
            
            # æ£€æŸ¥è¾“å‡º
            if "GPU Wall Time" in result.stdout:
                print("âœ… GPU timing data available")
            if "Correctness check: True" in result.stdout:
                print("âœ… Correctness verified")
            
            return True
        else:
            print(f"âŒ PyTorch Baseline: FAILED")
            print(f"Error: {result.stderr[:200]}")
            return False
    except Exception as e:
        print(f"âŒ Error: {e}")
        return False

if __name__ == "__main__":
    success = quick_test()
    if success:
        print("\nðŸŽ‰ Quick test passed! Ready for full experiments.")
    else:
        print("\nâŒ Quick test failed! Check the issues above.")
    sys.exit(0 if success else 1)
EOF

chmod +x quick_test.py
echo "âœ… Quick test script created"

# 3. è¿è¡Œå¿«é€Ÿæµ‹è¯•
echo "ðŸ§ª Running quick test..."
python3 quick_test.py

echo "ðŸŽ¯ Manual fix completed!"
